#!/bin/bash

# Must run after sourcing sasinit (just to get ftools)

if [ "$#" -ne 1 ]
then
    echo "Error: one argument (obsid) required, exiting"
    exit 1
fi

obsid=$1

# Ideally deduce this from the folder files, but whatever
exps="mos1S001 mos2S002 pnS003"

for exp in $exps
do
  echo "${exp} BACKSCAL calculation"

  fkeypar "${obsid}/odf/repro/${exp}-src-grp50.pi" BACKSCAL
  SRC_BACKSCAL="$(pget fkeypar value)"
  fkeypar "${obsid}/odf/repro/${exp}-bkg-grp50.pi" BACKSCAL
  BKG_BACKSCAL="$(pget fkeypar value)"

  echo "src: $SRC_BACKSCAL"
  echo "bkg: $BKG_BACKSCAL"
  # Why the fuck is bc -l giving me some total crap
  # NORM=$(echo "($SRC_BACKSCAL) / ($BKG_BACKSCAL)" | bc -l)
  NORM=$(perl -e "print( ($SRC_BACKSCAL) / ($BKG_BACKSCAL) );")
  echo "src/bkg = ($SRC_BACKSCAL) / ($BKG_BACKSCAL) = $NORM"
  echo ""
done

echo "If you got ANY warnings from fkeypar, results are invalid!"

